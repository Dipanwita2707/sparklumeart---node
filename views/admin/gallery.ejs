<!-- Admin Gallery Management -->
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/admin/dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/admin/users">
                            <i class="fas fa-users me-2"></i>
                            Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="/admin/gallery">
                            <i class="fas fa-images me-2"></i>
                            Gallery
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/admin/orders">
                            <i class="fas fa-shopping-cart me-2"></i>
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/admin/settings">
                            <i class="fas fa-cog me-2"></i>
                            Settings
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Gallery Management</h1>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGalleryModal">
                    <i class="fas fa-plus me-2"></i>Add New Image
                </button>
            </div>

            <!-- Flash Messages -->
            <% if (messages.success) { %>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <%= messages.success %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <% } %>
            <% if (messages.error) { %>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <%= messages.error %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <% } %>

            <!-- Gallery Grid -->
            <div class="row">
                <% galleryItems.forEach(item => { %>
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 gallery-item">
                            <div class="gallery-image-container">
                                <img src="<%= item.image %>" class="card-img-top gallery-image" alt="<%= item.artistName %>" 
                                     data-bs-toggle="modal" data-bs-target="#imageLightbox" 
                                     data-image="<%= item.image %>"
                                     data-artist="<%= item.artistName %>"
                                     data-description="<%= item.description %>">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title"><%= item.artistName %></h5>
                                <p class="card-text"><%= item.description %></p>
                                <p class="card-text">
                                    <small class="text-muted">Created: <%= new Date(item.createdDate).toLocaleDateString() %></small>
                                </p>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-outline-primary edit-gallery" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#editGalleryModal"
                                            data-id="<%= item._id %>"
                                            data-image="<%= item.image %>"
                                            data-artist="<%= item.artistName %>"
                                            data-date="<%= item.createdDate %>"
                                            data-description="<%= item.description %>">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <form action="/admin/gallery/<%= item._id %>/delete" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this image?')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </main>
    </div>
</div>

<!-- Add Gallery Modal -->
<div class="modal fade" id="addGalleryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="/admin/gallery/add" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="image" class="form-label">Image</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
                    </div>
                    <div class="mb-3">
                        <label for="artistName" class="form-label">Artist Name</label>
                        <input type="text" class="form-control" id="artistName" name="artistName" required>
                    </div>
                    <div class="mb-3">
                        <label for="createdDate" class="form-label">Creation Date</label>
                        <input type="date" class="form-control" id="createdDate" name="createdDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Image</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Gallery Modal -->
<div class="modal fade" id="editGalleryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editGalleryForm" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editImage" class="form-label">Current Image</label>
                        <img id="currentImage" src="" alt="Current Image" class="img-fluid mb-2" style="max-height: 200px;">
                        <input type="file" class="form-control" id="editImage" name="image" accept="image/*">
                        <small class="text-muted">Leave empty to keep current image</small>
                    </div>
                    <div class="mb-3">
                        <label for="editArtistName" class="form-label">Artist Name</label>
                        <input type="text" class="form-control" id="editArtistName" name="artistName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editCreatedDate" class="form-label">Creation Date</label>
                        <input type="date" class="form-control" id="editCreatedDate" name="createdDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Image</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Image Lightbox Modal -->
<div class="modal fade" id="imageLightbox" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="lightboxTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <img src="" class="img-fluid" id="lightboxImage" alt="">
            </div>
            <div class="modal-footer border-0">
                <p class="text-white mb-0" id="lightboxDescription"></p>
            </div>
        </div>
    </div>
</div>

<!-- Add custom styles for admin dashboard -->
<style>
.sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 100;
    padding: 48px 0 0;
    box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
}

.sidebar .nav-link {
    font-weight: 500;
    color: #333;
}

.sidebar .nav-link.active {
    color: #2470dc;
}

main {
    padding-top: 48px;
}

@media (max-width: 767.98px) {
    .sidebar {
        position: static;
        padding-top: 0;
    }
    main {
        padding-top: 0;
    }
}

/* Gallery Item Styles */
.gallery-item {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
}

.gallery-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.gallery-image-container {
    position: relative;
    overflow: hidden;
    height: 250px;
}

.gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.gallery-item:hover .gallery-image {
    transform: scale(1.1);
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.gallery-overlay i {
    color: white;
    font-size: 2rem;
    transform: scale(0.5);
    transition: transform 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.gallery-item:hover .gallery-overlay i {
    transform: scale(1);
}

/* Lightbox Styles */
#imageLightbox .modal-content {
    background-color: rgba(0,0,0,0.8);
}

#imageLightbox .modal-body {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 70vh;
}

#imageLightbox img {
    max-height: 70vh;
    max-width: 100%;
    object-fit: contain;
}

/* Card Animation */
.card {
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Stagger animation for cards */
.gallery-item:nth-child(1) { animation-delay: 0.1s; }
.gallery-item:nth-child(2) { animation-delay: 0.2s; }
.gallery-item:nth-child(3) { animation-delay: 0.3s; }
.gallery-item:nth-child(4) { animation-delay: 0.4s; }
.gallery-item:nth-child(5) { animation-delay: 0.5s; }
.gallery-item:nth-child(6) { animation-delay: 0.6s; }
</style>

<!-- Add JavaScript for lightbox and edit functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Lightbox functionality
    const galleryImages = document.querySelectorAll('.gallery-image');
    const lightboxModal = document.getElementById('imageLightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxTitle = document.getElementById('lightboxTitle');
    const lightboxDescription = document.getElementById('lightboxDescription');

    galleryImages.forEach(image => {
        image.addEventListener('click', function() {
            lightboxImage.src = this.dataset.image;
            lightboxTitle.textContent = this.dataset.artist;
            lightboxDescription.textContent = this.dataset.description;
        });
    });

    // Edit functionality
    const editButtons = document.querySelectorAll('.edit-gallery');
    const editModal = document.getElementById('editGalleryModal');
    const editForm = document.getElementById('editGalleryForm');

    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const id = this.dataset.id;
            const image = this.dataset.image;
            const artist = this.dataset.artist;
            const date = this.dataset.date;
            const description = this.dataset.description;

            // Update form action
            editForm.action = `/admin/gallery/${id}/update`;

            // Update form fields
            document.getElementById('currentImage').src = image;
            document.getElementById('editArtistName').value = artist;
            document.getElementById('editCreatedDate').value = date;
            document.getElementById('editDescription').value = description;
        });
    });
});
</script> 