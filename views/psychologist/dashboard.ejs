<%- include('../partials/header') %>
<%- include('../partials/psychologist-navbar') %>

<div class="container-fluid mt-4">
    <div class="row">
        <main class="col-md-12 ms-sm-auto px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Psychologist Dashboard</h1>
            </div>

            <!-- Tests Awaiting Review -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Tests Awaiting Review</h5>
                </div>
                <div class="card-body">
                    <% if (pendingTests && pendingTests.length > 0) { %>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>User Email</th>
                                        <th>Test Date</th>
                                        <th>Color Preference</th>
                                        <th>Style Preference</th>
                                        <th>Payment Date</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% pendingTests.forEach(test => { %>
                                        <tr>
                                            <td><%= test.user.name %></td>
                                            <td><%= test.user.email %></td>
                                            <td><%= new Date(test.createdAt).toLocaleDateString() %></td>
                                            <td><span class="badge bg-info"><%= test.colorPreference %></span></td>
                                            <td><span class="badge bg-secondary"><%= test.stylePreference %></span></td>
                                            <td><%= test.paymentDate ? new Date(test.paymentDate).toLocaleDateString() : 'N/A' %></td>
                                            <td>
                                                <a href="/psychologist/test/<%= test._id %>" class="btn btn-sm btn-primary">
                                                    <i class="fas fa-eye me-1"></i>Review
                                                </a>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>There are no tests awaiting review at this time.
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Reviewed Tests -->
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Reviewed Tests</h5>
                </div>
                <div class="card-body">
                    <% if (reviewedTests && reviewedTests.length > 0) { %>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Review Date</th>
                                        <th>Status</th>
                                        <th>Admin Quote</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% reviewedTests.forEach(test => { %>
                                        <tr>
                                            <td><%= test.user.name %></td>
                                            <td><%= new Date(test.psychologistFeedback.submittedAt).toLocaleDateString() %></td>
                                            <td>
                                                <% if (test.adminQuote && test.adminQuote.budget) { %>
                                                    <span class="badge bg-info">Quoted</span>
                                                <% } else { %>
                                                    <span class="badge bg-warning">Awaiting Quote</span>
                                                <% } %>
                                                
                                                <% if (test.order && test.order.approved) { %>
                                                    <span class="badge bg-success">Order Placed</span>
                                                <% } %>
                                            </td>
                                            <td>
                                                <% if (test.adminQuote && test.adminQuote.budget) { %>
                                                    â‚¹<%= test.adminQuote.budget %>
                                                <% } else { %>
                                                    N/A
                                                <% } %>
                                            </td>
                                            <td>
                                                <a href="/psychologist/test/<%= test._id %>" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye me-1"></i>View
                                                </a>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>You haven't reviewed any tests yet.
                        </div>
                    <% } %>
                </div>
            </div>
        </main>
    </div>
</div>

<%- include('../partials/footer') %> 